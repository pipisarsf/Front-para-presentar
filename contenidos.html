<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="assets/images/logo.png" type="image/png">
    <title>Instituto el Sabio</title>
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
    <div class="form-body">
        <img src="assets/images/logo.png" alt="logo institucional">
        <p class="text">Carga de Contenidos</p>

        <form class="opciones-form" action="guardar_contenido.php" method="POST" enctype="multipart/form-data">
            <label for="materia">Asignatura:</label>
            <select name="materia" id="materia" required>
                <option value="">Seleccione una asignatura</option>
            </select>
            <br>
            
            <label for="contenido">Contenido:</label>
            <select name="contenido" id="contenido" required>
                <option value="">Seleccione un contenido</option>
            </select>
            <br>

            <label for="alumno">Estudiante:</label>
            <select name="alumno" id="alumno" required>
                <option value="">Seleccione el estudiante</option>
            </select>
            <br>

            <label for="estadoContenido">Nivel de Desempeño:</label>
            <select name="estadoContenido" id="estadoContenido" required>
                <option value="">Seleccione un nivel de desempeño</option>
                <option value="Altamente Logrado">Altamente Logrado</option>
                <option value="Logrado">Logrado</option>
                <option value="Escasamente Logrado">Escasamente Logrado</option>
                <option value="Pendiente">Pendiente</option>
            </select>
            <br>

            <button type="submit">Guardar</button>
        </form>
    </div>

    <script>
        function llenarOpciones(lista, datos) {
            const select = document.getElementById(lista);
            select.innerHTML = '<option value="">Seleccione una opción</option>';
            if (datos) {
                datos.forEach(dato => {
                    const option = document.createElement("option");
                    option.text = dato.nombre_asignatura || dato.nombre_contenido || dato.nombre;
                    option.value = dato.id;
                    select.add(option);
                });
            }
        }

        window.onload = function() {
            fetch('obtener_datos.php')
            .then(response => {
                if (!response.ok) {
                    throw new Error("Error en la respuesta de la red");
                }
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    console.error('Error en los datos recibidos:', data.error);
                    return;
                }

                console.log(data); // Agrega esta línea para depurar

                if (data.asignatura) {
                    llenarOpciones("materia", data.asignatura);
                } else {
                    llenarOpciones("materia", [{ id: "", nombre_asignatura: "No hay asignaturas disponibles" }]);
                }

                if (data.estudiantes) {
                    llenarOpciones("alumno", data.estudiantes);
                } else {
                    llenarOpciones("alumno", [{ id: "", nombre: "No hay estudiantes disponibles" }]);
                }

                window.contenidos = data.contenidos;

                const materiaId = document.getElementById("materia").value;
                const contenidosFiltrados = window.contenidos.filter(contenido => contenido.materia_id == materiaId);
                llenarOpciones("contenido", contenidosFiltrados);

                console.log("Datos del docente:", data.docente);
            })
            .catch(error => console.error('Error al obtener los datos:', error));

            document.getElementById("materia").addEventListener("change", function() {
                const materiaId = this.value;
                const contenidosFiltrados = window.contenidos.filter(contenido => contenido.materia_id == materiaId);
                llenarOpciones("contenido", contenidosFiltrados);
            });
        };
    </script>
</body>
</html>
